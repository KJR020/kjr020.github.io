# Implementation Plan

## Tasks

- [x] 1. プロジェクトセットアップと依存関係の追加
- [x] 1.1 TanStack Query のインストールと設定
  - @tanstack/react-query パッケージを追加
  - QueryClientProvider を Astro のレイアウトに設定
  - _Requirements: 3.4_

- [x] 1.2 (P) 型定義ファイルの作成
  - Scrapbox API レスポンス型を定義
  - クライアント用の正規化されたページデータ型を定義
  - _Requirements: 1.3_

- [x] 2. ビルド時データ取得スクリプトの実装
- [x] 2.1 Scrapbox API からデータを取得する機能
  - 指定プロジェクトのページ一覧を API から取得
  - レスポンスを正規化されたデータ形式に変換
  - descriptions 配列を結合して説明文を生成
  - Unix タイムスタンプを ISO 8601 形式に変換
  - Scrapbox ページ URL を生成
  - _Requirements: 1.1, 1.3_

- [x] 2.2 JSON ファイル出力とエラーハンドリング
  - public/data ディレクトリに JSON ファイルを保存
  - API 失敗時はエラーログを出力し既存ファイルを保持
  - 環境変数からプロジェクト名を読み取り可能に
  - package.json の prebuild スクリプトに登録
  - _Requirements: 1.2, 1.4, 1.5_

- [x] 3. React Hooks の実装
- [x] 3.1 (P) 画像遅延読み込み Hook の作成
  - Intersection Observer で viewport 接近を検知
  - 画像読み込み完了状態を管理
  - フェードインアニメーション用の状態を提供
  - _Requirements: 4.1, 5.2_

- [x] 3.2 (P) データ取得 Hook の作成
  - TanStack Query を使用して JSON データを取得
  - プロジェクト名をキーにしたキャッシュ管理
  - 表示件数の制限オプションを提供
  - _Requirements: 3.1, 3.2, 3.4_

- [x] 4. カード UI コンポーネントの実装
- [x] 4.1 単一カードコンポーネントの作成
  - サムネイル画像、タイトル、説明文、リンクを表示
  - 画像が存在しない場合のプレースホルダー表示
  - 説明文を最大3行で省略表示
  - ホバー時の影とスケール変化エフェクト
  - クリックで Scrapbox ページを新しいタブで開く
  - 画像遅延読み込み Hook を統合
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 4.2 カードリストコンポーネントの作成
  - project と limit の Props を受け取り
  - データ取得 Hook を使用してページ一覧を取得
  - ローディング状態の表示
  - レスポンシブグリッドレイアウト（3/2/1 カラム）
  - project 未指定時のエラーメッセージ表示
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 3.2, 5.1_

- [x] 5. エラーハンドリングの実装
- [x] 5.1 各種エラー状態の UI 表示
  - データ 0 件時の「ページが見つかりません」メッセージ
  - ネットワークエラー時のリトライボタン付きエラー表示
  - JSON 未存在時の「データが見つかりません」メッセージ
  - 不正なデータ形式の安全な処理
  - _Requirements: 3.3, 6.1, 6.2, 6.3_

- [x] 6. 統合とデモページの作成
- [x] 6.1 Astro ページへの統合
  - デモ用の Scrapbox カードリストページを作成
  - client:load ディレクティブでコンポーネントを配置
  - タッチデバイスでのタップ操作確認
  - _Requirements: 2.3, 5.3_

- [x] 6.2 ビルド動作の確認
  - prebuild スクリプトが正しく実行されることを確認
  - JSON ファイルが正しく生成されることを確認
  - 開発サーバーでの動作確認
  - _Requirements: 1.1, 1.2_

## Requirements Coverage

| Requirement | Tasks |
|-------------|-------|
| 1.1 | 2.1, 6.2 |
| 1.2 | 2.2, 6.2 |
| 1.3 | 1.2, 2.1 |
| 1.4 | 2.2 |
| 1.5 | 2.2 |
| 2.1 | 4.2 |
| 2.2 | 4.2 |
| 2.3 | 4.2, 6.1 |
| 2.4 | 4.2 |
| 3.1 | 3.2 |
| 3.2 | 3.2, 4.2 |
| 3.3 | 5.1 |
| 3.4 | 1.1, 3.2 |
| 4.1 | 3.1, 4.1 |
| 4.2 | 4.1 |
| 4.3 | 4.1 |
| 4.4 | 4.1 |
| 4.5 | 4.1 |
| 5.1 | 4.2 |
| 5.2 | 3.1 |
| 5.3 | 6.1 |
| 6.1 | 5.1 |
| 6.2 | 5.1 |
| 6.3 | 5.1 |
